import{a as k,r as i,u as I,j as s,A as h}from"./index-83376b2f.js";import{V as M}from"./ViewCounter-f5097ec4.js";import{L as S}from"./LikeDislike-78ebc5c6.js";function _(){const f=k(),[n,x]=i.useState([]),{t:d,i18n:g}=I(),[m,w]=i.useState({views:new Map,ratings:new Map}),[c,j]=i.useState(1),o=12;i.useEffect(()=>{fetch("/posts/index.json").then(e=>e.json()).then(x).catch(()=>x([]))},[]),i.useEffect(()=>{if(n.length===0)return;const e=n.map(t=>t.filename);(async()=>{try{const t=new h.Query("Views");t.containedIn("itemId",e);const r=await t.find(),v=new Map(r.map(a=>[a.get("itemId"),a.get("views")])),u=new h.Query("Ratings");u.containedIn("itemId",e);const y=await u.find(),N=new Map(y.map(a=>[a.get("itemId"),{likes:a.get("likes")||0,dislikes:a.get("dislikes")||0,objectId:a.id}]));w({views:v,ratings:N})}catch(t){console.error("Failed to batch fetch stats:",t)}})()},[n]);const p=Math.ceil(n.length/o),b=n.slice((c-1)*o,c*o);return s.jsxs("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 py-10",children:[s.jsx("h1",{className:"text-2xl font-bold text-slate-800 mb-8",children:d("新闻")}),s.jsx("div",{className:"space-y-6",children:b.map(e=>{const l=m.views.get(e.filename)||0,t=m.ratings.get(e.filename)||{likes:0,dislikes:0};return s.jsxs("article",{className:"group",children:[s.jsxs("div",{className:"flex items-baseline gap-3 mb-1",children:[s.jsx("time",{className:"text-xs text-gray-400 font-mono whitespace-nowrap",children:e.date}),s.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400",children:[s.jsx(M,{views:l}),s.jsx(S,{itemId:e.filename,initialLikes:t.likes,initialDislikes:t.dislikes,objectId:t.objectId})]})]}),s.jsx("a",{onClick:()=>f(`/news/${e.filename}`),className:"text-base font-medium text-slate-800 hover:text-blue-600 cursor-pointer transition-colors no-underline",children:g.language==="zh"?e.title_zh:e.title_en}),s.jsx("p",{className:"text-sm text-gray-500 mt-1 line-clamp-2",children:g.language==="zh"?e.brief_zh:e.brief_en}),e.tags&&s.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:e.tags.slice(0,3).map(r=>s.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-blue-50 text-blue-600",children:d(r)},r))})]},e.filename)})}),p>1&&s.jsx("div",{className:"flex items-center justify-center gap-2 mt-10",children:Array.from({length:p},(e,l)=>l+1).map(e=>s.jsx("button",{onClick:()=>j(e),className:`w-8 h-8 rounded text-sm border-none cursor-pointer transition-colors ${e===c?"bg-slate-800 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:e},e))})]})}export{_ as default};
