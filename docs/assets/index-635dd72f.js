import{b as k,r,u as v,j as t,c as y,A as x}from"./index-d1c05346.js";import{V as I}from"./ViewCounter-81b94969.js";import{L as b,T as S}from"./LikeDislike-b71c0525.js";import{L as l}from"./index-b4167903.js";function H(){const w=k(),[a,c]=r.useState([]),{t:h,i18n:d}=v(),[p,u]=r.useState({views:new Map,ratings:new Map});return r.useEffect(()=>{(async()=>{try{const i=await fetch("/posts/index.json");if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const s=await i.json();c(s)}catch(i){console.error("Failed to load posts index:",i),c([])}})()},[]),r.useEffect(()=>{if(a.length===0)return;const e=a.map(s=>s.filename);(async()=>{try{const s=new x.Query("Views");s.containedIn("itemId",e);const o=await s.find(),g=new Map(o.map(n=>[n.get("itemId"),n.get("views")])),f=new x.Query("Ratings");f.containedIn("itemId",e);const m=await f.find(),j=new Map(m.map(n=>[n.get("itemId"),{likes:n.get("likes")||0,dislikes:n.get("dislikes")||0,objectId:n.id}]));u({views:g,ratings:j})}catch(s){console.error("Failed to batch fetch stats:",s)}})()},[a]),t.jsx(l,{itemLayout:"vertical",size:"small",dataSource:a,pagination:{pageSize:12},renderItem:e=>{const i=p.views.get(e.filename)||0,s=p.ratings.get(e.filename)||{likes:0,dislikes:0};return t.jsx(l.Item,{style:{padding:"6px 8px",borderBottom:"1px solid #f0f0f0",margin:0,lineHeight:1.3},children:t.jsx(l.Item.Meta,{title:t.jsx("a",{onClick:()=>w(`/news/${e.filename}`),style:{margin:12,fontSize:"17px",color:"#1890ff",margin:0,lineHeight:1.5},children:d.language==="zh"?e.title_zh:e.title_en}),description:t.jsxs("div",{style:{marginTop:2},children:[t.jsxs(y,{size:"small",style:{fontSize:"11px",color:"#666"},children:[t.jsx("span",{children:e.date}),t.jsx(I,{views:i}),t.jsx(b,{itemId:e.filename,initialLikes:s.likes,initialDislikes:s.dislikes,objectId:s.objectId}),t.jsx("div",{children:e.tags&&e.tags.slice(0,2).map((o,g)=>t.jsx(S,{style:{fontSize:"10px",padding:"0 3px",height:"16px",lineHeight:"16px",margin:0},color:"blue",children:h(o)},o))})]}),t.jsx("div",{style:{fontSize:"12px",color:"#555",marginTop:"3px",lineHeight:1.2,maxHeight:"32px",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:d.language==="zh"?e.brief_zh:e.brief_en})]})})},e.filename)}})}export{H as default};
