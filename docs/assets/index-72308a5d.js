import{b as I,r,u as k,j as t,c as b,A as w}from"./index-37a71212.js";import{V as v}from"./ViewCounter-3661fa12.js";import{L as y,T as M}from"./LikeDislike-cdae04d3.js";import{L as c}from"./index-d562db57.js";function E(){const u=I(),[i,l]=r.useState([]),{t:x,i18n:d}=k(),[p,h]=r.useState({views:new Map,ratings:new Map});return r.useEffect(()=>{(async()=>{try{const a=await fetch("/posts/index.json");if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const s=await a.json();l(s)}catch(a){console.error("Failed to load posts index:",a),l([])}})()},[]),r.useEffect(()=>{if(i.length===0)return;const e=i.map(s=>s.filename);(async()=>{try{const s=new w.Query("Views");s.containedIn("itemId",e);const o=await s.find(),g=new Map(o.map(n=>[n.get("itemId"),n.get("views")])),f=new w.Query("Ratings");f.containedIn("itemId",e);const j=await f.find(),m=new Map(j.map(n=>[n.get("itemId"),{likes:n.get("likes")||0,dislikes:n.get("dislikes")||0,objectId:n.id}]));h({views:g,ratings:m})}catch(s){console.error("Failed to batch fetch stats:",s)}})()},[i]),t.jsx(c,{itemLayout:"vertical",size:"small",dataSource:i,pagination:{pageSize:10},renderItem:e=>{const a=p.views.get(e.filename)||0,s=p.ratings.get(e.filename)||{likes:0,dislikes:0};return t.jsxs(c.Item,{style:{marginBottom:"16px",padding:"16px",border:"1px solid #f0f0f0",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"},children:[t.jsx(c.Item.Meta,{title:t.jsx("a",{onClick:()=>u(`/news/${e.filename}`),children:d.language==="zh"?e.title_zh:e.title_en}),description:t.jsxs(b,{children:[t.jsx("span",{children:e.date}),t.jsx(v,{views:a}),t.jsx(y,{itemId:e.filename,initialLikes:s.likes,initialDislikes:s.dislikes,objectId:s.objectId}),t.jsx("div",{children:e.tags&&e.tags.map((o,g)=>t.jsx(M,{bordered:!1,color:"blue",children:x(o)},o))})]})}),d.language=="zh"?e.brief_zh:e.brief_en]},e.filename)}})}export{E as default};
