import{u as I,r as n,j as s,A as S}from"./index-83376b2f.js";import{L as D}from"./LikeDislike-78ebc5c6.js";function _(){const{t:d,i18n:u}=I(),[i,p]=n.useState([]),[o,f]=n.useState([]),[m,h]=n.useState([]),[y,b]=n.useState([]),[j,w]=n.useState({}),[v,g]=n.useState(!0),[N,k]=n.useState(new Map);n.useEffect(()=>{(async()=>{try{g(!0);const t=await(await fetch("/research/index.json")).json();f(t),h(t);const l=t.flatMap(a=>a.keywords).reduce((a,c)=>(a[c]=(a[c]||0)+1,a),{});w(l);const x=[...new Set(t.flatMap(a=>a.keywords))].sort((a,c)=>l[c]-l[a]);b(x)}catch(r){console.error("Failed to load research data:",r)}finally{g(!1)}})()},[]),n.useEffect(()=>{const e=o.map(t=>t.id);if(e.length===0)return;(async()=>{try{const t=new S.Query("Ratings");t.containedIn("itemId",e),t.limit(1e3);const l=await t.find(),x=new Map(l.map(a=>[a.get("itemId"),{likes:a.get("likes")||0,dislikes:a.get("dislikes")||0,objectId:a.id}]));k(x)}catch(t){console.error("Failed to batch fetch ratings:",t)}})()},[o]),n.useEffect(()=>{i.length>0?h(o.filter(e=>i.some(r=>e.keywords.includes(r)))):h(o)},[i,o]);const R=e=>{p(r=>r.includes(e)?r.filter(t=>t!==e):[...r,e])};return s.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 py-10",children:[s.jsx("h1",{className:"text-2xl font-bold text-slate-800 mb-6",children:d("研究")}),s.jsx("div",{className:"flex flex-wrap gap-2 mb-8",children:y.map(e=>s.jsxs("button",{onClick:()=>R(e),className:`text-xs px-3 py-1 rounded-full border cursor-pointer transition-colors ${i.includes(e)?"bg-slate-800 text-white border-slate-800":"bg-white text-gray-600 border-gray-300 hover:border-gray-400"}`,children:[d(e)," (",j[e],")"]},e))}),v?s.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(e=>s.jsx("div",{className:"h-32 bg-gray-200 rounded"},e))}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:m.map(e=>{var t;const r=N.get(e.id)||{likes:0,dislikes:0,objectId:null};return s.jsxs("a",{href:e.src,target:"_blank",rel:"noopener noreferrer",className:"group block rounded-lg border border-gray-200 overflow-hidden hover:shadow-md transition-shadow no-underline",children:[s.jsx("div",{className:"aspect-video overflow-hidden bg-gray-100",children:s.jsx("img",{src:e.imgpath,alt:u.language==="zh"?e.title_zh:e.title_en,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"})}),s.jsxs("div",{className:"p-4",children:[s.jsx("h3",{className:"text-sm font-medium text-slate-800 line-clamp-2 mb-1",children:u.language==="zh"?e.title_zh:e.title_en}),s.jsx("p",{className:"text-xs text-gray-500 line-clamp-2 mb-2",children:u.language==="zh"?e.description:e.description_en}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"flex flex-wrap gap-1",children:(t=e.keywords)==null?void 0:t.map(l=>s.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-blue-50 text-blue-600",children:d(l)},l))}),s.jsx("div",{onClick:l=>l.preventDefault(),children:s.jsx(D,{itemId:e.id,initialLikes:r.likes,initialDislikes:r.dislikes,objectId:r.objectId})})]})]})]},e.id)})})]})}export{_ as default};
