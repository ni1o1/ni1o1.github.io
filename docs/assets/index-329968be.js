import{u as b,r as i,j as a,T as I,R as z,C as x,A as L}from"./index-f66defce.js";import{T as v,L as D}from"./LikeDislike-31ebdebd.js";import{L as f}from"./index-46babe5b.js";function K(){const{t:u,i18n:d}=b(),[c,M]=i.useState([]),[o,y]=i.useState([]),[w,p]=i.useState([]),[C,k]=i.useState([]),[T,m]=i.useState({}),[j,h]=i.useState(!0),[R,S]=i.useState(new Map);return i.useEffect(()=>{(async()=>{try{h(!0);const t=await(await fetch("/research/index.json")).json();y(t),p(t);const n=t.flatMap(s=>s.keywords).reduce((s,l)=>(s[l]=(s[l]||0)+1,s),{});m(n);const g=[...new Set(t.flatMap(s=>s.keywords))].sort((s,l)=>n[l]-n[s]);k(g)}catch(r){console.error("Failed to load research data:",r)}finally{h(!1)}})()},[]),i.useEffect(()=>{const e=o.map(t=>t.id);if(e.length===0)return;(async()=>{try{const t=new L.Query("Ratings");t.containedIn("itemId",e),t.limit(1e3);const n=await t.find(),g=new Map(n.map(s=>[s.get("itemId"),{likes:s.get("likes")||0,dislikes:s.get("dislikes")||0,objectId:s.id}]));S(g)}catch(t){console.error("Failed to batch fetch ratings:",t)}})()},[o]),i.useEffect(()=>{c.length>0?p(o.filter(e=>c.some(r=>e.keywords.includes(r)))):p(o)},[c]),a.jsx(I,{style:{padding:"10px 20px"},children:a.jsx(f,{itemLayout:"vertical",size:"small",dataSource:w,loading:j,pagination:{pageSize:100,showSizeChanger:!1},renderItem:e=>{const r=R.get(e.id)||{likes:0,dislikes:0,objectId:null};return a.jsx(f.Item,{style:{padding:"8px 0",borderBottom:"1px solid #f0f0f0",margin:0},children:a.jsxs(z,{gutter:[16,8],align:"top",children:[a.jsxs(x,{xs:24,sm:24,md:16,lg:18,children:[a.jsx("a",{href:e.src,target:"_blank",style:{color:"#1890ff",margin:12,fontSize:"17px",margin:0,lineHeight:1.5},children:d.language==="zh"?e.title_zh:e.title_en}),a.jsx("div",{style:{fontSize:"13px",color:"#555",lineHeight:1.4,marginBottom:"6px",maxHeight:"42px",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:d.language==="zh"?e.description:e.description_en}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap"},children:[e.keywords&&e.keywords.map(t=>a.jsx(v,{color:"blue",style:{margin:0,fontSize:"11px",padding:"0 6px",height:"20px",lineHeight:"20px"},children:u(t)},t)),a.jsx(D,{itemId:e.id,initialLikes:r.likes,initialDislikes:r.dislikes,objectId:r.objectId})]})]}),a.jsx(x,{xs:24,sm:24,md:8,lg:6,children:a.jsx("img",{alt:d.language==="zh"?e.title_zh:e.title_en,src:e.imgpath,style:{objectFit:"cover",width:"100%",height:"120px",borderRadius:"4px",marginTop:"4px"}})})]})},e.id)}})})}export{K as default};
