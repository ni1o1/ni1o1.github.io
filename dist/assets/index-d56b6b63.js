import{u as I,r as n,j as s,A as S}from"./index-64944a6a.js";import{L as D}from"./LikeDislike-40c2f537.js";function K(){const{t:d,i18n:x}=I(),[c,p]=n.useState([]),[o,g]=n.useState([]),[m,u]=n.useState([]),[j,y]=n.useState([]),[b,w]=n.useState({}),[N,f]=n.useState(!0),[v,R]=n.useState(new Map);n.useEffect(()=>{(async()=>{try{f(!0);const t=await(await fetch("/research/index.json")).json();g(t),u(t);const l=t.flatMap(a=>a.keywords).reduce((a,i)=>(a[i]=(a[i]||0)+1,a),{});w(l);const h=[...new Set(t.flatMap(a=>a.keywords))].sort((a,i)=>l[i]-l[a]);y(h)}catch(r){console.error("Failed to load research data:",r)}finally{f(!1)}})()},[]),n.useEffect(()=>{const e=o.map(t=>t.id);if(e.length===0)return;(async()=>{try{const t=new S.Query("Ratings");t.containedIn("itemId",e),t.limit(1e3);const l=await t.find(),h=new Map(l.map(a=>[a.get("itemId"),{likes:a.get("likes")||0,objectId:a.id}]));R(h)}catch(t){console.error("Failed to batch fetch ratings:",t)}})()},[o]),n.useEffect(()=>{c.length>0?u(o.filter(e=>c.some(r=>e.keywords.includes(r)))):u(o)},[c,o]);const k=e=>{p(r=>r.includes(e)?r.filter(t=>t!==e):[...r,e])};return s.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 py-10",children:[s.jsx("h1",{className:"text-2xl font-bold text-slate-800 mb-6",children:d("研究")}),s.jsx("div",{className:"flex flex-wrap gap-2 mb-8",children:j.map(e=>s.jsxs("button",{onClick:()=>k(e),className:`text-xs px-3 py-1 rounded-full border cursor-pointer transition-colors ${c.includes(e)?"bg-slate-800 text-white border-slate-800":"bg-white text-gray-600 border-gray-300 hover:border-gray-400"}`,children:[d(e)," (",b[e],")"]},e))}),N?s.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(e=>s.jsx("div",{className:"h-32 bg-gray-200 rounded"},e))}):s.jsx("div",{className:"space-y-8",children:m.map(e=>{var t;const r=v.get(e.id)||{likes:0,objectId:null};return s.jsxs("div",{className:"flex flex-col sm:flex-row gap-6",children:[s.jsx("a",{href:e.src,target:"_blank",rel:"noopener noreferrer",className:"flex-shrink-0 group",children:s.jsx("div",{className:"w-full sm:w-48 aspect-video overflow-hidden bg-gray-100 flex items-center justify-center",children:s.jsx("img",{src:e.imgpath,alt:x.language==="zh"?e.title_zh:e.title_en,className:"max-w-full max-h-full object-contain group-hover:scale-105 transition-transform duration-300"})})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("a",{href:e.src,target:"_blank",rel:"noopener noreferrer",className:"no-underline",children:s.jsx("h3",{className:"text-base font-medium text-slate-800 hover:text-blue-600 transition-colors mb-2",children:x.language==="zh"?e.title_zh:e.title_en})}),s.jsx("p",{className:"text-sm text-gray-600 leading-relaxed mb-3",children:x.language==="zh"?e.description:e.description_en}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"flex flex-wrap gap-1",children:(t=e.keywords)==null?void 0:t.map(l=>s.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-blue-50 text-blue-600",children:d(l)},l))}),s.jsx("div",{onClick:l=>l.preventDefault(),children:s.jsx(D,{itemId:e.id,initialLikes:r.likes,objectId:r.objectId})})]})]})]},e.id)})})]})}export{K as default};
