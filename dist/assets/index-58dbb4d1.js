import{a as I,r as i,u as k,j as t,A as h}from"./index-912442eb.js";import{V as M}from"./ViewCounter-af3ebeaa.js";import{L as S}from"./LikeDislike-87e48d77.js";function _(){const f=I(),[n,x]=i.useState([]),{t:d,i18n:g}=k(),[m,w]=i.useState({views:new Map,ratings:new Map}),[l,j]=i.useState(1),o=12;i.useEffect(()=>{fetch("/posts/index.json").then(e=>e.json()).then(x).catch(()=>x([]))},[]),i.useEffect(()=>{if(n.length===0)return;const e=n.map(s=>s.filename);(async()=>{try{const s=new h.Query("Views");s.containedIn("itemId",e);const c=await s.find(),v=new Map(c.map(a=>[a.get("itemId"),a.get("views")])),u=new h.Query("Ratings");u.containedIn("itemId",e);const y=await u.find(),N=new Map(y.map(a=>[a.get("itemId"),{likes:a.get("likes")||0,objectId:a.id}]));w({views:v,ratings:N})}catch(s){console.error("Failed to batch fetch stats:",s)}})()},[n]);const p=Math.ceil(n.length/o),b=n.slice((l-1)*o,l*o);return t.jsxs("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 py-10",children:[t.jsx("h1",{className:"text-2xl font-bold text-slate-800 mb-8",children:d("新闻")}),t.jsx("div",{className:"space-y-6",children:b.map(e=>{const r=m.views.get(e.filename)||0,s=m.ratings.get(e.filename)||{likes:0};return t.jsxs("article",{className:"group",children:[t.jsxs("div",{className:"flex items-baseline gap-3 mb-1",children:[t.jsx("time",{className:"text-xs text-gray-400 font-mono whitespace-nowrap",children:e.date}),t.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400",children:[t.jsx(M,{views:r}),t.jsx(S,{itemId:e.filename,initialLikes:s.likes,objectId:s.objectId})]})]}),t.jsx("a",{onClick:()=>f(`/news/${e.filename}`),className:"text-base font-medium text-slate-800 hover:text-blue-600 cursor-pointer transition-colors no-underline",children:g.language==="zh"?e.title_zh:e.title_en}),t.jsx("p",{className:"text-sm text-gray-500 mt-1 line-clamp-2",children:g.language==="zh"?e.brief_zh:e.brief_en}),e.tags&&t.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:e.tags.slice(0,3).map(c=>t.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-blue-50 text-blue-600",children:d(c)},c))})]},e.filename)})}),p>1&&t.jsx("div",{className:"flex items-center justify-center gap-2 mt-10",children:Array.from({length:p},(e,r)=>r+1).map(e=>t.jsx("button",{onClick:()=>j(e),className:`w-8 h-8 rounded text-sm border-none cursor-pointer transition-colors ${e===l?"bg-slate-800 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:e},e))})]})}export{_ as default};
