import{a as S,r as n,u as k,j as s}from"./index-aff23722.js";import{V as M}from"./ViewCounter-b0e6d504.js";import{L as _}from"./LikeDislike-af504377.js";const h={}.VITE_API_BASE_URL||"";function T(){const d=S(),[a,l]=n.useState([]),{t:p,i18n:x}=k(),[g,f]=n.useState({views:new Map,ratings:new Map}),[o,u]=n.useState(1),c=12;n.useEffect(()=>{fetch("/posts/index.json").then(e=>e.json()).then(l).catch(()=>l([]))},[]),n.useEffect(()=>{if(a.length===0)return;const e=a.map(t=>t.filename);(async()=>{try{const r=await(await fetch(`${h}/api/views`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({itemIds:e})})).json(),j=new Map(Object.entries(r)),b=await(await fetch(`${h}/api/ratings`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({itemIds:e})})).json(),y=new Map(Object.entries(b).map(([N,v])=>[N,{likes:v.likes||0}]));f({views:j,ratings:y})}catch(t){console.error("Failed to batch fetch stats:",t)}})()},[a]);const m=Math.ceil(a.length/c),w=a.slice((o-1)*c,o*c);return s.jsxs("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 py-10",children:[s.jsx("h1",{className:"text-2xl font-bold text-slate-800 mb-8",children:p("新闻")}),s.jsx("div",{className:"space-y-6",children:w.map(e=>{const i=g.views.get(e.filename)||0,t=g.ratings.get(e.filename)||{likes:0};return s.jsxs("article",{className:"group",children:[s.jsxs("div",{className:"flex items-baseline gap-3 mb-1",children:[s.jsx("time",{className:"text-xs text-gray-400 font-mono whitespace-nowrap",children:e.date}),s.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400",children:[s.jsx(M,{views:i}),s.jsx(_,{itemId:e.filename,initialLikes:t.likes})]})]}),s.jsx("a",{onClick:()=>d(`/news/${e.filename}`),className:"text-base font-medium text-slate-800 hover:text-blue-600 cursor-pointer transition-colors no-underline",children:x.language==="zh"?e.title_zh:e.title_en}),s.jsx("p",{className:"text-sm text-gray-500 mt-1 line-clamp-2",children:x.language==="zh"?e.brief_zh:e.brief_en}),e.tags&&s.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:e.tags.slice(0,3).map(r=>s.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-blue-50 text-blue-600",children:p(r)},r))})]},e.filename)})}),m>1&&s.jsx("div",{className:"flex items-center justify-center gap-2 mt-10",children:Array.from({length:m},(e,i)=>i+1).map(e=>s.jsx("button",{onClick:()=>u(e),className:`w-8 h-8 rounded text-sm border-none cursor-pointer transition-colors ${e===o?"bg-slate-800 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:e},e))})]})}export{T as default};
