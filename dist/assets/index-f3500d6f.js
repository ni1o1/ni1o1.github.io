import{u as k,r as l,j as s}from"./index-a5a8e52f.js";import{L as _}from"./LikeDislike-fefe194f.js";const E={}.VITE_API_BASE_URL||"";function M(){const{t:d,i18n:x}=k(),[i,p]=l.useState([]),[c,g]=l.useState([]),[m,h]=l.useState([]),[y,j]=l.useState([]),[b,w]=l.useState({}),[N,u]=l.useState(!0),[v,S]=l.useState(new Map);l.useEffect(()=>{(async()=>{try{u(!0);const t=await(await fetch("/research/index.json")).json();g(t),h(t);const n=t.flatMap(r=>r.keywords).reduce((r,o)=>(r[o]=(r[o]||0)+1,r),{});w(n);const f=[...new Set(t.flatMap(r=>r.keywords))].sort((r,o)=>n[o]-n[r]);j(f)}catch(a){console.error("Failed to load research data:",a)}finally{u(!1)}})()},[]),l.useEffect(()=>{const e=c.map(t=>t.id);if(e.length===0)return;(async()=>{try{const n=await(await fetch(`${E}/api/ratings`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({itemIds:e})})).json(),f=new Map(Object.entries(n).map(([r,o])=>[r,{likes:o.likes||0}]));S(f)}catch(t){console.error("Failed to batch fetch ratings:",t)}})()},[c]),l.useEffect(()=>{i.length>0?h(c.filter(e=>i.some(a=>e.keywords.includes(a)))):h(c)},[i,c]);const R=e=>{p(a=>a.includes(e)?a.filter(t=>t!==e):[...a,e])};return s.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 py-10",children:[s.jsx("h1",{className:"text-2xl font-bold text-slate-800 mb-6",children:d("研究")}),s.jsx("div",{className:"flex flex-wrap gap-2 mb-8",children:y.map(e=>s.jsxs("button",{onClick:()=>R(e),className:`text-xs px-3 py-1 rounded-full border cursor-pointer transition-colors ${i.includes(e)?"bg-slate-800 text-white border-slate-800":"bg-white text-gray-600 border-gray-300 hover:border-gray-400"}`,children:[d(e)," (",b[e],")"]},e))}),N?s.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(e=>s.jsx("div",{className:"h-32 bg-gray-200 rounded"},e))}):s.jsx("div",{className:"space-y-8",children:m.map(e=>{var t;const a=v.get(e.id)||{likes:0};return s.jsxs("div",{className:"flex flex-col sm:flex-row gap-6",children:[s.jsx("a",{href:e.src,target:"_blank",rel:"noopener noreferrer",className:"flex-shrink-0 group",children:s.jsx("div",{className:"w-full sm:w-48 aspect-video overflow-hidden bg-gray-100 flex items-center justify-center",children:s.jsx("img",{src:e.imgpath,alt:x.language==="zh"?e.title_zh:e.title_en,className:"max-w-full max-h-full object-contain group-hover:scale-105 transition-transform duration-300"})})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("a",{href:e.src,target:"_blank",rel:"noopener noreferrer",className:"no-underline",children:s.jsx("h3",{className:"text-base font-medium text-slate-800 hover:text-blue-600 transition-colors mb-2",children:x.language==="zh"?e.title_zh:e.title_en})}),s.jsx("p",{className:"text-sm text-gray-600 leading-relaxed mb-3",children:x.language==="zh"?e.description:e.description_en}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"flex flex-wrap gap-1",children:(t=e.keywords)==null?void 0:t.map(n=>s.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-blue-50 text-blue-600",children:d(n)},n))}),s.jsx("div",{onClick:n=>n.preventDefault(),children:s.jsx(_,{itemId:e.id,initialLikes:a.likes})})]})]})]},e.id)})})]})}export{M as default};
